name: rollbar-java CI
on:
  push:
    branches: [master]
  pull_request:
    branches: [master]

jobs:
  release:
    runs-on: ubuntu-20.04
    # It would be nice to run this as part of the build job, since it would be
    # faster and have less duplicated Yaml, it would not be possible to check
    # for all matrix results before publishing if this were just another step
    # in that job.
    steps:
      - uses: actions/checkout@v2

      - name: Release
        env:
          SECRING_GPG_IV: ${{ secrets.SECRING_GPG_IV }}
          SECRING_GPG_KEY: ${{ secrets.SECRING_GPG_KEY }}
          GPG_KEY_ID: ${{ secrets.GPG_KEY_ID }}
          GPG_PASSPHRASE: ${{ secrets.GPG_PASSPHRASE }}
          ENCRYPTED_GPG_KEY_LOCATION: ./.github/secring.gpg.enc
          GPG_KEY_LOCATION: ./.github/secring.gpg
          NEXUS_USERNAME: ${{ secrets.NEXUS_USERNAME }}
          NEXUS_PASSWORD: ${{ secrets.NEXUS_PASSWORD }}
        run: |
          python3 -c "import sys; print(len(sys.argv[1]))" "$GPG_KEY_ID"
